{"version":3,"sources":["admin/pagebuilder.js"],"names":["jQuery","fireEditors","tinyMCE","triggerSave","each","Event","bubbles","document","on","e","preventDefault","parents","hide","remove","unbind","css","ready","window","off","pb","Vue","el","data","pbData","msg","sections","showSections","reOrder","publish","position","attr","beforeCreate","before","t","this","$el","querySelector","value","xml","output","replace","children","i","length","innerHTML","html","nodeName","$set","Math","toString","substr","ii","attributes","random","mounted","ajax","context","ajax_url","url","pbInfo","method","success","res","JSON","parse","updated","wpColorPicker","checkOrder","methods","switchPb","wp","editor","id","val","content","reorder","start","end","splice","deleteSection","addSection","slug","showOptions","u_id","options","push","showSectionsFunc","pos","section","change","event","dispatchEvent","clear","prev","checkPublish","$nextTick","click","checkPreview","preview","watch","handler","newVal","attrs","Object","keys","v","deep"],"mappings":"aAQAA,SAAOC,cAGLC,QAAQC,cADVH,OAASC,gBAAcG,KAAA,WACrBF,OAAQC,MAAAA,GAAAA,cAAR,IAAAE,MAAA,QAAA,CAAAC,SAAA,OAVFN,OAAOO,UAAUC,GAAG,QAAS,mBAAoB,SAASC,GAD1DA,EAAAC,iBACAV,OAAOO,MAAPI,QAAoB,aAASC,OAC3BH,OAAEC,MAAAA,QAAF,kCAAAG,SACAb,OAAO,yBAAPc,WAEAd,OAAAA,mBAAOe,IAAA,UAAP,QAAAH,OACDZ,OALD,iBAAAY,OAiBAZ,OAAOO,UAAUS,MAAM,WADvBhB,OAAAiB,QAAAC,IAAA,eAAA,QAMA,IAAIC,GAAK,IAAIC,IAAI,CADjBC,GAAA,qBACAC,KAAIH,CACFE,OAAI,GACJC,IAAM,GACJC,IAAAA,EACAC,UAFI,EAGJL,cAHI,EAIJM,SAAAA,EACAC,SAAAA,EACAC,SAAS,EACTC,SAAS,OAETC,aAAU,WAXG7B,OAAA,gBAAA8B,KAAA,SAAA,OAafC,OAAAA,gBAAcC,OAAA,mPAEZhC,YAAO,WAfM,IAkBTiC,EAAIC,KAARC,IAAAC,cAAA,YAAAC,MAEAC,EAAIA,QADJA,EAAIC,EAAAA,QAAJ,QAAA,KAAAC,QAAA,QAAA,KAAAA,QAAA,MAAA,kBACmBJ,QACnBE,IAGEA,GAFFA,EAAMtC,OAASsC,SAAMA,GACrBA,EAAItC,OAAAsC,GAAAG,WAAAA,WAGF,IADAH,KAAMtC,OAAA,GACN0C,EAAS,EAAAA,EAAAJ,EAAAK,OAAAD,IAAA,CACP,IAAKnB,EAALe,EAAAI,GAAAE,UAAAJ,QAAA,iBAAA,KAOE,IANFN,KAAKQ,KAAOA,KAAIJ,OAAIK,EAAQD,IAC1BR,KAAIW,KAAAA,KAAWH,OAAGE,GAAAA,OAAUJ,EAAQE,GAAAI,UACpCZ,KAAKa,KAAKb,KAAKX,OAAfmB,GAA0B,UAA1BG,GACAX,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,eAAeI,GACzCZ,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,OAAAM,KAAWH,SAArCI,SAAA,IAAAC,OAAA,EAAA,IACAhB,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,UAAA,IACrBK,GAAK,EAAAI,GAAK5B,EAAOmB,GAAtBU,WAAkCJ,OAAKK,KAASJ,CAChD,IAAKF,EAAKT,EAAKf,GAAAA,WAAW4B,IAA1BL,SACKK,EAALb,EAAaa,GAAKb,WAAOc,IAAAA,UAAmBD,QAAM,iBAAA,KAChDjB,KAAIJ,KAAAA,KAAWY,OAAGU,GAAAA,QAAeN,EAAAA,KAKtC,MAAArC,GAEHyB,KAAAf,IAAU,EACRe,KAAKf,IAAK,+DAGbmC,QAhDc,WAiDfA,OAASC,KAAA,CACPvD,QAAAkC,KACEsB,IAAAA,OAASC,SACTC,OAAKC,MACLC,KAAAA,CACAtC,OAAM,oBAAAuC,QAJI,SAAAC,GAOVD,KAAAA,SAASE,KAAAC,MAAAF,OAIZG,QA7Dc,WA8DfA,OAAS,iBAAAC,gBACPlE,KAAO2B,UACPwC,aACEA,KAAAA,SAAAA,IAGHC,QApEc,CAqEfA,SAAS,WACPC,GAAAA,KAAUlD,GACRlB,kBACEA,CADFD,OAGK,gBAAAI,KAAA,WAAEkE,GAAAC,OAAA1D,OAAAqB,KAAAsC,MAEHF,IAEE/B,EAHJvC,OAAA,YAAAyE,MAGAjC,QAAA,QAAA,KAAAA,QAAA,QAAA,KAAAA,QAAA,MAAA,iBACAF,EAAIoC,OAAU1E,EAAO,QACrB,IAGEsC,GAFFA,EAAMtC,OAASsC,SAAMA,GACrBA,EAAItC,OAAAsC,GAAAG,WAAAA,WAGF,IADAH,KAAMtC,OAAA,GACN0C,EAAS,EAAAA,EAAAJ,EAAAK,OAAAD,IAAA,CACP,IAAKnB,EAALe,EAAAI,GAAAE,UAAAJ,QAAA,iBAAA,KAOE,IANFN,KAAKQ,KAAOA,KAAIJ,OAAIK,EAAQD,IAC1BR,KAAIW,KAAAA,KAAWH,OAAGE,GAAAA,OAAUJ,EAAQE,GAAAI,UACpCZ,KAAKa,KAAKb,KAAKX,OAAfmB,GAA0B,UAA1BG,GACAX,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,eAAeI,GACzCZ,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,OAAAM,KAAWH,SAArCI,SAAA,IAAAC,OAAA,EAAA,IACAhB,KAAKa,KAAKb,KAAKX,OAAOmB,GAAI,UAAA,IACrBK,GAAK,EAAAI,GAAK5B,EAAOmB,GAAtBU,WAAkCJ,OAAKK,KAASJ,CAChD,IAAKF,EAAKT,EAAKf,GAAAA,WAAW4B,IAA1BL,SACKK,EAALb,EAAaa,GAAKb,WAAOc,IAAAA,UAAmBD,QAAM,iBAAA,KAChDjB,KAAIJ,KAAAA,KAAWY,OAAGU,GAAAA,QAAeN,EAAAA,IAIpCZ,KAAAV,IAAA,GAEH,MAAKA,GAEPU,KAAAV,IAAU,6DAETU,KAAAP,SAAA,EAEFO,KAAAf,IAAAe,KAAAf,GACDe,KAAAV,MACAU,KAAIf,IAAJ,IAGDwD,QA5CM,SAAAC,EAAAC,GA6CPF,KAAAA,OAASG,OAAAD,EAASD,EAAAA,KAAOC,OAAKC,OAAAF,EAAA,GAAA,IAC5B1C,KAAKX,SAAOuD,GAEbC,cAhDM,SAAArC,GAiDPqC,QAAe,yCAEb7C,KAAOX,OAAAuD,OAAApC,EAAA,GACL1C,OAAKuB,gBAALnB,KAAA,WACAJ,GAAAA,OAAOa,OAAAqB,KAAgB9B,MAEtB8B,KAFDP,SAAA,IAKHqD,WA1DM,SAAAC,GA2DPD,OAAAA,gBAAY5E,KAAA,WACVJ,GAAAA,OAAOa,OAAAqB,KAAgB9B,MAAvB,OAAA8B,KAAAL,SAGAK,KAAIX,OAAKM,QAAY,CACnBoD,KAAK1D,EACHmD,QAAQO,GACRC,aAFkB,EAGlBC,KAAAnC,KAAAK,SAHkBJ,SAAA,IAAAC,OAAA,EAAA,GAIlBkC,QAAQpC,KAKVd,KAAKX,OAAO8D,KAAK,CACfJ,KAAQA,EACRP,QAAW,GACXQ,aAAe,EACfC,KAAQnC,KAAKK,SAASJ,SAAS,IAAIC,OAAO,EAAG,GAC7CkC,QAAW,KAGflD,KAAKR,cAAe,EACpBQ,KAAKP,SAAU,GAEjB2D,iBAAkB,SAAAC,GAChBrD,KAAKR,cAAe,EACpBQ,KAAKL,SAAW0D,GAAO,OAEzBL,YAAa,SAAAM,GACXA,EAAQN,aAAc,EACtBlF,OAAO,iBAAiBkE,cAAc,CACpCuB,OAAQ,SAAAC,EAASA,GACf1F,OAAOkC,MAAM,GAAGyD,cAAc,IAAItF,MAAM,QAAS,CAAAC,SAAC,QAGtDN,OAAO,iBAAiBkE,cAAc,CACpC0B,MAAO,WACL5F,OAAOkC,MAAM2D,OAAOpD,SAAS,SAAS,GAAGkD,cAAc,IAAItF,MAAM,QAAS,CAAAC,SAAC,SAIjFwF,aAAc,WACZ7F,cACAiC,KAAK6D,UAAU,WACb7D,KAAKN,SAAU,EACf5B,OAAO,YAAYgG,WAGvBC,aAAc,WACZhG,cACAiC,KAAK6D,UAAU,WACb7D,KAAKgE,SAAU,EACflG,OAAO,iBAAiBgG,YAI9BG,MAAO,CACL5E,OAAQ,CACN6E,QAAS,SAAAC,EAASA,GAChB,GAAuB,oBAAZnG,QAAX,CAGA,IAAIqC,EAAS,GACb,IAAKG,EAAI,EAAGA,EAAI2D,EAAO1D,OAAQD,IAAK,CAClC,IAAI4D,EAAQ,GACRlB,EAAUmB,OAAOC,KAAKH,EAAO3D,GAAG0C,SACpC,IAAKjC,GAAK,EAAGA,GAAKiC,EAAQzC,OAAQQ,MAC5BsD,EAAIJ,EAAO3D,GAAG0C,QAAQA,EAAQjC,QAChCmD,GAAS,IAAMlB,EAAQjC,IAAM,KAAOsD,EAAI,KAG5ClE,GAAU,KAAO8D,EAAO3D,GAAGuC,KAAOqB,EAAQ,KAAOD,EAAO3D,GAAGgC,QAAU,MAAQ2B,EAAO3D,GAAGuC,KAAO,OAEhGjF,OAAO,YAAY6C,KAAKN,KAE1BmE,MAAM,MAKZ1G,OAAO,YAAYQ,GAAG,QAAS,SAAAC,GACzBU,GAAGS,UAKLT,EAAAA,iBACDA,GAAA2E,kBAID9F,OAAImB,iBAAYX,GAAA,QAAA,SAAAC,GACdU,GAAG+E,QACH/E,GAAA+E,SAAA,GAKDzF,EAAAC,iBARHS,GAAA8E","file":"pagebuilder.min.js","sourcesContent":["// Close lightbox if cancelled\njQuery(document).on('click', '.lightbox-cancel', function(e) {\n  e.preventDefault();\n  jQuery(this).parents('.lightbox').hide();\n  jQuery(this).parents('.lightbox:not(#module-choices)').remove();\n  jQuery('.module-choice button').unbind();\n});\njQuery('#module-choices').css('display', 'flex').hide();\njQuery('#content-tmce').hide();\n\nfunction fireEditors() {\n  tinyMCE.triggerSave();\n  jQuery('.text-editor').each(function() {\n    jQuery(this)[0].dispatchEvent(new Event('input', {'bubbles': true}));\n  });\n}\n\n// Prevent \"you are leaving the site\" warning\njQuery(document).ready(function() {\n  jQuery(window).off('beforeunload', null);\n});\n\n// Create the vue instance\nvar pb = new Vue({\n  el: '#post-body-content',\n  data: {\n    pbData: [],\n    msg: '',\n    pb: true,\n    sections: false,\n    showSections: false,\n    reOrder: false,\n    publish: false,\n    preview: false,\n    position: 'top'\n  },\n  beforeCreate: function() {\n    jQuery('#postdivrich').attr('v-show', '!pb');\n    jQuery('#postdivrich').before('<button id=\"page-builder-btn\" class=\"button\" @click.prevent=\"switchPb()\"><span v-bind:class=\"\\'dashicons dashicons-\\' + (pb ? \\'text\\' : \\'hammer\\')\"></span>Switch to {{pb ? \"Editor\" : \"PageBuilder\"}}</button><div v-if=\"msg\">{{msg}}</div>');\n  },\n  beforeMount: function() {\n    var t = this;\n    var output = '';\n    var xml = this.$el.querySelector('#content').value;\n    xml = xml.replace(/\\[\\[/g, '<').replace(/\\]\\]/g, '>').replace(/\\&/g, '~~ampersand~~');\n    xml = '<pb>' + xml + '</pb>';\n    try {\n      xml = jQuery.parseXML(xml);\n      xml = jQuery(xml).children().children();\n      if (xml) {\n        this.pbData = [];\n        for (i = 0; i < xml.length; i++) {\n          var html = xml[i].innerHTML.replace(/~~ampersand~~/g, '&');\n          this.$set(this.pbData, i, {});\n          this.$set(this.pbData[i], 'slug', xml[i].nodeName);\n          this.$set(this.pbData[i], 'content', html);\n          this.$set(this.pbData[i], 'showOptions', false);\n          this.$set(this.pbData[i], 'u_id', Math.random().toString(36).substr(2, 9));\n          this.$set(this.pbData[i], 'options', {});\n          for (ii = 0; ii < xml[i].attributes.length; ii++) {\n            var attr = xml[i].attributes[ii].nodeName;\n            var val = xml[i].attributes[ii].nodeValue.replace(/~~ampersand~~/g, '&');\n            this.$set(this.pbData[i].options, attr, val);\n          }\n        }\n      }\n    }\n    catch (e) {\n      this.pb = false;\n      this.msg = 'Your shortcodes are invalid. Please review and fix errors.';\n    }\n  },\n  mounted: function() {\n    jQuery.ajax({\n      context: this,\n      url: pbInfo.ajax_url,\n      method: 'get',\n      data: {\n        action: '_sw_get_sections'\n      },\n      success: function(res) {\n        this.sections = JSON.parse(res);\n      }\n    });\n  },\n  updated: function() {\n    jQuery('.color-picker').wpColorPicker();\n    if (this.reOrder) {\n      checkOrder();\n      this.reOrder = false;\n    }\n  },\n  methods: {\n    switchPb: function() {\n      if (this.pb) { // going to text\n        fireEditors();\n      }\n      else { // going to pb\n        jQuery('.text-editor').each(function() {\n          wp.editor.remove(this.id);\n        });\n        var output = '';\n        var content = jQuery('#content').val();\n        var xml = content.replace(/\\[\\[/g, '<').replace(/\\]\\]/g, '>').replace(/\\&/g, '~~ampersand~~');\n        xml = '<pb>' + xml + '</pb>';\n        try {\n          xml = jQuery.parseXML(xml);\n          xml = jQuery(xml).children().children();\n          if (xml) {\n            this.pbData = [];\n            for (i = 0; i < xml.length; i++) {\n              var html = xml[i].innerHTML.replace(/~~ampersand~~/g, '&');\n              this.$set(this.pbData, i, {});\n              this.$set(this.pbData[i], 'slug', xml[i].nodeName);\n              this.$set(this.pbData[i], 'content', html);\n              this.$set(this.pbData[i], 'showOptions', false);\n              this.$set(this.pbData[i], 'u_id', Math.random().toString(36).substr(2, 9));\n              this.$set(this.pbData[i], 'options', {});\n              for (ii = 0; ii < xml[i].attributes.length; ii++) {\n                var attr = xml[i].attributes[ii].nodeName;\n                var val = xml[i].attributes[ii].nodeValue.replace(/~~ampersand~~/g, '&');\n                this.$set(this.pbData[i].options, attr, val);\n              }\n            }\n          }\n          this.msg = '';\n        }\n        catch (e) {\n          this.msg = 'Your shortcodes are invalid. Please review and fix errors.';\n        }\n        this.reOrder = true;\n      }\n      this.pb = !this.pb;\n      if (this.msg) {\n        this.pb = false;\n      }\n    },\n    reorder: function(start, end) {\n      this.pbData.splice(end, 0, this.pbData.splice(start, 1)[0]);\n      this.reOrder = true;\n    },\n    deleteSection: function(i) {\n      var v = confirm('Do you want to delete this section?');\n      if (v) {\n        this.pbData.splice(i, 1);\n        jQuery('.text-editor').each(function() {\n          wp.editor.remove(this.id);\n        });\n        this.reOrder = true;\n      }\n    },\n    addSection: function(slug) {\n      jQuery('.text-editor').each(function() {\n        wp.editor.remove(this.id);\n      });\n      if (this.position == 'top') {\n        this.pbData.unshift({\n          'slug': slug,\n          'content': '',\n          'showOptions': false,\n          'u_id': Math.random().toString(36).substr(2, 9),\n          'options': {}\n        });\n      }\n      else {\n        this.pbData.push({\n          'slug': slug,\n          'content': '',\n          'showOptions': false,\n          'u_id': Math.random().toString(36).substr(2, 9),\n          'options': {}\n        });\n      }\n      this.showSections = false;\n      this.reOrder = true;\n    },\n    showSectionsFunc: function(pos) {\n      this.showSections = true;\n      this.position = pos || 'top';\n    },\n    showOptions: function(section) {\n      section.showOptions = true;\n      jQuery('.color-picker').wpColorPicker({\n        change: function(event, ui) {\n          jQuery(this)[0].dispatchEvent(new Event('input', {'bubbles': true}));\n        }\n      });\n      jQuery('.color-picker').wpColorPicker({\n        clear: function() {\n          jQuery(this).prev().children('input')[0].dispatchEvent(new Event('input', {'bubbles': true}));\n        }\n      });\n    },\n    checkPublish: function() {\n      fireEditors();\n      this.$nextTick(function() {\n        this.publish = true;\n        jQuery('#publish').click();\n      });\n    },\n    checkPreview: function() {\n      fireEditors();\n      this.$nextTick(function() {\n        this.preview = true;\n        jQuery('#post-preview').click();\n      });\n    }\n  },\n  watch: {\n    pbData: {\n      handler: function(newVal, oldVal) {\n        if (typeof tinyMCE === 'undefined') {\n          return;\n        }\n        var output = '';\n        for (i = 0; i < newVal.length; i++) {\n          var attrs = '';\n          var options = Object.keys(newVal[i].options);\n          for (ii = 0; ii < options.length; ii++) {\n            if (v = newVal[i].options[options[ii]]) {\n              attrs += ' ' + options[ii] + '=\"' + v + '\"';\n            }\n          }\n          output += '[[' + newVal[i].slug + attrs + ']]' + newVal[i].content + '[[/' + newVal[i].slug + ']]\\n';\n        }\n        jQuery('#content').html(output);\n      },\n      deep: true\n    }\n  }\n});\n\njQuery('#publish').on('click', function(e) {\n  if (pb.publish) {\n    return;\n  }\n  else {\n    e.preventDefault();\n    pb.checkPublish();\n  }\n});\n\njQuery('#post-preview').on('click', function(e) {\n  if (pb.preview) {\n    pb.preview = false;\n    return;\n  }\n  else {\n    e.preventDefault();\n    pb.checkPreview();\n  }\n});\n"]}