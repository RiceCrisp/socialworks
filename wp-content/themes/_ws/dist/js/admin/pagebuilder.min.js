"use strict";function fireEditors(){tinyMCE.triggerSave(),jQuery(".text-editor").each(function(){jQuery(this)[0].dispatchEvent(new Event("input",{bubbles:!0}))})}jQuery(document).on("click",".lightbox-cancel",function(t){t.preventDefault(),jQuery(this).parents(".lightbox").hide(),jQuery(this).parents(".lightbox:not(#module-choices)").remove(),jQuery(".module-choice button").unbind()}),jQuery("#module-choices").css("display","flex").hide(),jQuery("#content-tmce").hide(),jQuery(document).ready(function(){jQuery(window).off("beforeunload",null)});var pb=new Vue({el:"#post-body-content",data:{pbData:[],msg:"",pb:!0,sections:!1,showSections:!1,reOrder:!1,publish:!1,preview:!1,position:"top"},beforeCreate:function(){jQuery("#postdivrich").attr("v-show","!pb"),jQuery("#postdivrich").before('<button id="page-builder-btn" class="button" @click.prevent="switchPb()"><span v-bind:class="\'dashicons dashicons-\' + (pb ? \'text\' : \'hammer\')"></span>Switch to {{pb ? "Editor" : "PageBuilder"}}</button><div v-if="msg">{{msg}}</div>')},beforeMount:function(){var t=this.$el.querySelector("#content").value;t="<pb>"+(t=t.replace(/\[\[/g,"<").replace(/\]\]/g,">").replace(/\&/g,"~~ampersand~~"))+"</pb>";try{if(t=jQuery.parseXML(t),t=jQuery(t).children().children())for(this.pbData=[],i=0;i<t.length;i++){var e=t[i].innerHTML.replace(/~~ampersand~~/g,"&");for(this.$set(this.pbData,i,{}),this.$set(this.pbData[i],"slug",t[i].nodeName),this.$set(this.pbData[i],"content",e),this.$set(this.pbData[i],"showOptions",!1),this.$set(this.pbData[i],"u_id",Math.random().toString(36).substr(2,9)),this.$set(this.pbData[i],"options",{}),ii=0;ii<t[i].attributes.length;ii++){var s=t[i].attributes[ii].nodeName,r=t[i].attributes[ii].nodeValue.replace(/~~ampersand~~/g,"&");this.$set(this.pbData[i].options,s,r)}}}catch(t){this.pb=!1,this.msg="Your shortcodes are invalid. Please review and fix errors."}},mounted:function(){jQuery.ajax({context:this,url:pbInfo.ajax_url,method:"get",data:{action:"_ws_get_sections"},success:function(t){this.sections=JSON.parse(t)}})},updated:function(){jQuery(".color-picker").wpColorPicker(),this.reOrder&&(checkOrder(),this.reOrder=!1)},methods:{switchPb:function(){if(this.pb)fireEditors();else{jQuery(".text-editor").each(function(){wp.editor.remove(this.id)});var t=jQuery("#content").val().replace(/\[\[/g,"<").replace(/\]\]/g,">").replace(/\&/g,"~~ampersand~~");t="<pb>"+t+"</pb>";try{if(t=jQuery.parseXML(t),t=jQuery(t).children().children())for(this.pbData=[],i=0;i<t.length;i++){var e=t[i].innerHTML.replace(/~~ampersand~~/g,"&");for(this.$set(this.pbData,i,{}),this.$set(this.pbData[i],"slug",t[i].nodeName),this.$set(this.pbData[i],"content",e),this.$set(this.pbData[i],"showOptions",!1),this.$set(this.pbData[i],"u_id",Math.random().toString(36).substr(2,9)),this.$set(this.pbData[i],"options",{}),ii=0;ii<t[i].attributes.length;ii++){var s=t[i].attributes[ii].nodeName,r=t[i].attributes[ii].nodeValue.replace(/~~ampersand~~/g,"&");this.$set(this.pbData[i].options,s,r)}}this.msg=""}catch(t){this.msg="Your shortcodes are invalid. Please review and fix errors."}this.reOrder=!0}this.pb=!this.pb,this.msg&&(this.pb=!1)},reorder:function(t,i){this.pbData.splice(i,0,this.pbData.splice(t,1)[0]),this.reOrder=!0},deleteSection:function(t){confirm("Do you want to delete this section?")&&(this.pbData.splice(t,1),jQuery(".text-editor").each(function(){wp.editor.remove(this.id)}),this.reOrder=!0)},addSection:function(t){jQuery(".text-editor").each(function(){wp.editor.remove(this.id)}),"top"==this.position?this.pbData.unshift({slug:t,content:"",showOptions:!1,u_id:Math.random().toString(36).substr(2,9),options:{}}):this.pbData.push({slug:t,content:"",showOptions:!1,u_id:Math.random().toString(36).substr(2,9),options:{}}),this.showSections=!1,this.reOrder=!0},showSectionsFunc:function(t){this.showSections=!0,this.position=t||"top"},showOptions:function(t){t.showOptions=!0,jQuery(".color-picker").wpColorPicker({change:function(t,i){jQuery(this)[0].dispatchEvent(new Event("input",{bubbles:!0}))}}),jQuery(".color-picker").wpColorPicker({clear:function(){jQuery(this).prev().children("input")[0].dispatchEvent(new Event("input",{bubbles:!0}))}})},checkPublish:function(){fireEditors(),this.$nextTick(function(){this.publish=!0,jQuery("#publish").click()})},checkPreview:function(){fireEditors(),this.$nextTick(function(){this.preview=!0,jQuery("#post-preview").click()})}},watch:{pbData:{handler:function(t,e){if("undefined"!=typeof tinyMCE){var s="";for(i=0;i<t.length;i++){var r="",n=Object.keys(t[i].options);for(ii=0;ii<n.length;ii++)(v=t[i].options[n[ii]])&&(r+=" "+n[ii]+'="'+v+'"');s+="[["+t[i].slug+r+"]]"+t[i].content+"[[/"+t[i].slug+"]]\n"}jQuery("#content").html(s)}},deep:!0}}});jQuery("#publish").on("click",function(t){pb.publish||(t.preventDefault(),pb.checkPublish())}),jQuery("#post-preview").on("click",function(t){pb.preview?pb.preview=!1:(t.preventDefault(),pb.checkPreview())});
//# sourceMappingURL=pagebuilder.min.js.map
